{% extends 'base.html' %}
{% block title %}{{ t('job_details') if t('job_details') != 'job_details' else 'Job Details' }}{% endblock %}

{% block content %}
<div class="container">
  <div class="row mb-3">
    <div class="col-12 d-flex align-items-center justify-content-between">
      <h2 class="mb-0">{{ job.title }}</h2>
      <div class="d-flex gap-2">
        <a class="btn btn-outline-secondary" href="{{ url_for('main.jobs') }}">
          <i class="fa fa-arrow-left me-1"></i> {{ t('back_to_jobs') if t('back_to_jobs') != 'back_to_jobs' else 'Back to Jobs' }}
        </a>
        <a class="btn btn-primary" href="{{ url_for('chat.chat_room', job_id=job.id) }}">
          <i class="fa fa-comments me-1"></i> {{ t('open_chat') if t('open_chat') != 'open_chat' else 'Open Chat' }}
        </a>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-8">
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title">{{ t('description') if t('description') != 'description' else 'Description' }}</h5>
          <p class="card-text">{{ job.description or '-' }}</p>
          <div class="row g-3">
            <div class="col-md-4">
              <div class="small text-muted">{{ t('budget') if t('budget') != 'budget' else 'Budget' }}</div>
              <div class="fw-semibold">{{ job.budget if job.budget is not none else '-' }}</div>
            </div>
            <div class="col-md-4">
              <div class="small text-muted">{{ t('location') if t('location') != 'location' else 'Location' }}</div>
              <div class="fw-semibold">{{ job.location or '-' }}</div>
            </div>
            <div class="col-md-4">
              <div class="small text-muted">{{ t('status') if t('status') != 'status' else 'Status' }}</div>
              <div class="fw-semibold">{{ job.status or 'open' }}</div>
            </div>
          </div>
        </div>
      </div>

      {% if current_user.is_authenticated and current_user.id != job.user_id %}
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title"><i class="fa fa-paper-plane me-1"></i>{{ t('apply_to_job') if t('apply_to_job') != 'apply_to_job' else 'Apply to this Job' }}</h5>
          <form method="post" action="{{ url_for('jobs.apply_to_job', job_id=job.id) }}">
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label">{{ t('offer_amount') if t('offer_amount') != 'offer_amount' else 'Offer Amount' }}</label>
                <input type="number" step="0.01" class="form-control" name="offer_amount" placeholder="e.g., 1200" />
              </div>
              <div class="col-12">
                <label class="form-label">{{ t('message') if t('message') != 'message' else 'Message' }}</label>
                <textarea class="form-control" name="message" rows="3" placeholder="{{ t('message_placeholder') if t('message_placeholder') != 'message_placeholder' else 'Add a note for the client...' }}"></textarea>
              </div>
              <div class="col-12">
                <button type="submit" class="btn btn-success">
                  <i class="fa fa-check me-1"></i>{{ t('submit_application') if t('submit_application') != 'submit_application' else 'Submit Application' }}
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
      {% endif %}
    </div>

    <div class="col-lg-4">
      {% if current_user.is_authenticated and current_user.id == job.user_id %}
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title"><i class="fa fa-users me-1"></i>{{ t('applications') if t('applications') != 'applications' else 'Applications' }}</h5>
          {% if applications %}
          <ul class="list-group list-group-flush">
            {% for app in applications %}
            <li class="list-group-item">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <div class="fw-semibold">{{ app.applicant.first_name or app.applicant.username }}</div>
                  <div class="small text-muted">{{ app.message or '-' }}</div>
                </div>
                <span class="badge bg-secondary">{{ app.status }}</span>
              </div>
            </li>
            {% endfor %}
          </ul>
          <a class="btn btn-link mt-2 p-0" href="{{ url_for('jobs.job_applications', job_id=job.id) }}">{{ t('manage_applications') if t('manage_applications') != 'manage_applications' else 'Manage all applications' }}</a>
          {% else %}
          <div class="text-muted">{{ t('no_applications_yet') if t('no_applications_yet') != 'no_applications_yet' else 'No applications yet.' }}</div>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
